!function(){"use strict";window.ScatterPlotViewer=class{constructor(t,i){this.canvas=t,this.ctx=t.getContext("2d",{alpha:!0}),this.mainRenderer=i,this.scale=this.canvas.width/parseFloat(getComputedStyle(this.canvas).width),this.xData=null,this.yData=null,this.xLabel="X",this.yLabel="Y",this.xMin=0,this.xMax=1,this.yMin=0,this.yMax=1,this.paddingLeft=55*this.scale,this.paddingRight=20*this.scale,this.paddingTop=16*this.scale,this.paddingBottom=60*this.scale,this.plotWidth=0,this.plotHeight=0,this.hoveredIndex=-1,this.currentFrameIndex=-1,this.setupInteraction(),"undefined"!=typeof document&&(this.frameChangeHandler=t=>{t.detail&&void 0!==t.detail.frameIndex&&(this.currentFrameIndex=t.detail.frameIndex,this.render())},document.addEventListener("py2dmol-frame-change",this.frameChangeHandler))}setData(t,i,e="X",s="Y"){if(this.xData=t,this.yData=i,this.xLabel=e,this.yLabel=s,!t||!i||0===t.length||0===i.length)return this.xMin=0,this.xMax=1,this.yMin=0,void(this.yMax=1);this.xMin=Math.min(...t),this.xMax=Math.max(...t),this.yMin=Math.min(...i),this.yMax=Math.max(...i);const a=this.xMax-this.xMin,h=this.yMax-this.yMin;a>0?(this.xMin-=.05*a,this.xMax+=.05*a):(this.xMin-=.5,this.xMax+=.5),h>0?(this.yMin-=.05*h,this.yMax+=.05*h):(this.yMin-=.5,this.yMax+=.5),this.currentFrameIndex=0,this.render()}addPoint(t,i){if(this.xData&&this.yData||(this.xData=[],this.yData=[]),this.xData.push(t),this.yData.push(i),1===this.xData.length)this.xMin=t-.5,this.xMax=t+.5,this.yMin=i-.5,this.yMax=i+.5;else{if(t<this.xMin||t>this.xMax||i<this.yMin||i>this.yMax){const t=Math.min(...this.xData),i=Math.max(...this.xData),e=Math.min(...this.yData),s=Math.max(...this.yData),a=i-t,h=s-e;a>0?(this.xMin=t-.05*a,this.xMax=i+.05*a):(this.xMin=t-.5,this.xMax=i+.5),h>0?(this.yMin=e-.05*h,this.yMax=s+.05*h):(this.yMin=e-.5,this.yMax=s+.5)}}this.render()}dataToCanvas(t,i){return{x:this.paddingLeft+(t-this.xMin)/(this.xMax-this.xMin)*this.plotWidth,y:this.canvas.height-this.paddingBottom-(i-this.yMin)/(this.yMax-this.yMin)*this.plotHeight}}canvasToData(t,i){return{x:this.xMin+(t-this.paddingLeft)/this.plotWidth*(this.xMax-this.xMin),y:this.yMin+(this.canvas.height-this.paddingBottom-i)/this.plotHeight*(this.yMax-this.yMin)}}findNearestPoint(t,i){if(!this.xData||!this.yData||0===this.xData.length)return-1;let e=1/0,s=-1;const a=12*this.sizeUnit;for(let h=0;h<this.xData.length;h++){const n=this.dataToCanvas(this.xData[h],this.yData[h]),d=n.x-t,o=n.y-i,r=Math.sqrt(d*d+o*o);r<e&&r<a&&(e=r,s=h)}return s}getMousePos(t){const i=this.canvas.getBoundingClientRect(),e=void 0!==t.clientX?t.clientX:t.touches&&t.touches[0]?t.touches[0].clientX:t.changedTouches[0].clientX,s=void 0!==t.clientY?t.clientY:t.touches&&t.touches[0]?t.touches[0].clientY:t.changedTouches[0].clientY;return{x:(e-i.left)*this.scale,y:(s-i.top)*this.scale}}setupInteraction(){this.canvas.addEventListener("mousemove",t=>{const{x:i,y:e}=this.getMousePos(t),s=this.findNearestPoint(i,e);s!==this.hoveredIndex&&(this.hoveredIndex=s,this.render(),this.canvas.style.cursor=s>=0?"pointer":"default")}),this.canvas.addEventListener("mouseleave",()=>{this.hoveredIndex>=0&&(this.hoveredIndex=-1,this.render()),this.canvas.style.cursor="default"}),this.canvas.addEventListener("click",t=>{const{x:i,y:e}=this.getMousePos(t),s=this.findNearestPoint(i,e);s>=0&&this.mainRenderer&&this.mainRenderer.setFrame(s)})}getSizeUnit(){const t=this.canvas.getBoundingClientRect?this.canvas.getBoundingClientRect():{width:this.canvas.width/this.scale,height:this.canvas.height/this.scale},i=Math.max(Math.min(t.width,t.height),60)/320,e=Math.min(Math.max(i,.7),1.6);return this.scale*e}render(){const t=this.ctx,i=this.canvas.width,e=this.canvas.height;this.sizeUnit=this.getSizeUnit();const s=12*this.sizeUnit,a=16*this.sizeUnit,h=this.getNiceTicks(this.xMin,this.xMax,5),n=this.getNiceTicks(this.yMin,this.yMax,5);this.computeDynamicPadding(t,this.sizeUnit,s,a,h,n),this.plotWidth=i-this.paddingLeft-this.paddingRight,this.plotHeight=e-this.paddingTop-this.paddingBottom,t.clearRect(0,0,i,e),t.fillStyle="#ffffff",t.fillRect(0,0,i,e),this.drawAxes(h,n,this.sizeUnit,s,a),this.xData&&this.yData&&this.xData.length>0&&this.drawPoints()}computeDynamicPadding(t,i,e,s,a,h){const n=(i,e)=>{const s=t.measureText(i),a=s.actualBoundingBoxAscent||.7*e,h=s.actualBoundingBoxDescent||.3*e;return{width:s.width,height:a+h}},d=4*i,o=4*i,r=8*i,c=10*i;t.save(),t.font=`${e}px sans-serif`;const l=t=>this.formatTickNumber(t),x=a.map(l),g=h.map(l),M=n("0",e).height,m=x.length>0?Math.max(...x.map(t=>n(t,e).width)):e,p=g.length>0?Math.max(...g.map(t=>n(t,e).width)):e;t.font=`${s}px sans-serif`;const f=n(this.xLabel||"X",s),y=n(this.yLabel||"Y",s);this.textMetrics={tickMarkLen:d,tickLabelGap:o,labelGap:r,xTickHeight:M,maxXTickWidth:m,maxYTickWidth:p,xLabelHeight:f.height,yLabelWidth:y.width,yLabelHeight:y.height},this.paddingBottom=Math.max(d+o+M+r+f.height,30*this.scale);const u=y.height;this.paddingLeft=Math.max(d+o+p+r+u,40*this.scale),this.paddingRight=Math.max(c+d+o+m/2,20*this.scale),this.paddingTop=Math.max(c+M/2,16*this.scale),t.restore()}drawAxes(t,i,e,s,a){const h=this.ctx,n=this.canvas.width,d=this.canvas.height,o=this.textMetrics||{tickMarkLen:4*e,tickLabelGap:4*e,labelGap:8*e,xTickHeight:s,xLabelHeight:a,yLabelWidth:a,maxYTickWidth:s};h.strokeStyle="#333",h.lineWidth=2*this.scale,h.fillStyle="#333",h.textAlign="center",h.textBaseline="middle",h.font=`${s}px sans-serif`,h.beginPath(),h.moveTo(this.paddingLeft,d-this.paddingBottom),h.lineTo(n-this.paddingRight,d-this.paddingBottom),h.stroke(),h.beginPath(),h.moveTo(this.paddingLeft,this.paddingTop),h.lineTo(this.paddingLeft,d-this.paddingBottom),h.stroke(),h.font=`${a}px sans-serif`;const r=d-this.paddingBottom+o.tickMarkLen+o.tickLabelGap+o.xTickHeight+o.labelGap+(o.xLabelHeight||a)/2;h.fillText(this.xLabel,this.paddingLeft+this.plotWidth/2,r),h.save();const c=o.tickMarkLen+o.tickLabelGap+o.maxYTickWidth+o.labelGap;h.translate(this.paddingLeft-c,this.paddingTop+this.plotHeight/2),h.rotate(-Math.PI/2),h.fillText(this.yLabel,0,0),h.restore(),this.drawTicks(t,i,e,s)}getNiceTicks(t,i,e=5){const s=i-t;if(0===s)return[t];const a=s/e,h=Math.pow(10,Math.floor(Math.log10(a))),n=a/h;let d;d=n<=1?1:n<=2?2:n<=5?5:10;const o=d*h,r=Math.ceil(t/o),c=Math.floor(i/o),l=[];for(let t=r;t<=c;t++)l.push(t*o);return l}formatTickNumber(t){if(0===t)return"0";const i=Math.abs(t);let e;return e=i>=1e6?(t/1e6).toFixed(1).replace(/\.?0+$/,"")+"M":i>=1e3?(t/1e3).toFixed(1).replace(/\.?0+$/,"")+"k":i>=100?t.toFixed(0):i>=1?t.toFixed(1).replace(/\.?0+$/,""):i>=.01?t.toFixed(2).replace(/\.?0+$/,""):t.toFixed(3).replace(/\.?0+$/,""),e}drawTicks(t,i,e,s){const a=this.ctx,h=this.canvas.height;a.font=`${s}px sans-serif`,a.fillStyle="#666",a.strokeStyle="#999",a.lineWidth=1*e;for(const i of t){const t=this.dataToCanvas(i,this.yMin);a.beginPath(),a.moveTo(t.x,h-this.paddingBottom),a.lineTo(t.x,h-this.paddingBottom+4*e),a.stroke(),a.textAlign="center",a.textBaseline="top",a.fillText(this.formatTickNumber(i),t.x,h-this.paddingBottom+6*e)}for(const t of i){const i=this.dataToCanvas(this.xMin,t);a.beginPath(),a.moveTo(this.paddingLeft-4*e,i.y),a.lineTo(this.paddingLeft,i.y),a.stroke(),a.textAlign="right",a.textBaseline="middle",a.fillText(this.formatTickNumber(t),this.paddingLeft-6*e,i.y)}}drawPoints(){const t=this.ctx,i=4*this.sizeUnit,e=(e,s)=>{const a=this.dataToCanvas(this.xData[e],this.yData[e]);t.beginPath(),t.arc(a.x,a.y,i,0,2*Math.PI),t.fillStyle=s,t.fill()};for(let t=this.xData.length-1;t>=0;t--){const i=t===this.currentFrameIndex,s=t===this.hoveredIndex;if(i||s)continue;let a;a=this.currentFrameIndex>=0&&t>this.currentFrameIndex?"#bfdbfe":"#3b82f6",e(t,a)}if(this.hoveredIndex>=0&&this.hoveredIndex!==this.currentFrameIndex&&e(this.hoveredIndex,"#60a5fa"),this.currentFrameIndex>=0){const e=this.dataToCanvas(this.xData[this.currentFrameIndex],this.yData[this.currentFrameIndex]);t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI),t.fillStyle="#fbbf24",t.fill(),t.strokeStyle="#f59e0b",t.lineWidth=2*this.scale,t.stroke()}}destroy(){this.frameChangeHandler&&document.removeEventListener("py2dmol-frame-change",this.frameChangeHandler)}},"undefined"!=typeof document&&document.dispatchEvent(new Event("py2dmol_scatter_loaded"))}();