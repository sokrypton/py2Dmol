<style>
#mainContainer * { box-sizing: border-box; }
#mainContainer {
    display: flex; flex-direction: row; align-items: flex-start; gap: 15px;
    background: transparent; padding: 8px; margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
#viewerWrapper {
    display: flex; flex-direction: column; gap: 8px; align-items: flex-start;
    width: fit-content; max-width: 100%;
    flex: 0 0 auto;
}
#canvasContainer, #scatterContainer {
    display: inline-block; border: 1px solid #ddd; border-radius: 12px;
    overflow: hidden; background: #ffffff; resize: both;
    position: relative;
    box-sizing: border-box;
    flex: 0 0 auto;
    align-self: flex-start;
}
#canvasContainer { width: 600px; height: 600px; min-width: 200px; min-height: 200px; }
#scatterContainer { min-width: 200px; min-height: 200px; }
#canvasContainer::-webkit-resizer { display: none; }
#scatterContainer::-webkit-resizer { display: none; }
#canvasContainer .resize-handle, #scatterContainer .resize-handle {
    position: absolute; bottom: 2px; right: 2px; width: 16px; height: 16px;
    cursor: nwse-resize; opacity: 0.4; transition: opacity 0.2s; z-index: 100; pointer-events: none;
}
#canvasContainer:hover .resize-handle, #scatterContainer:hover .resize-handle { opacity: 0.8; }
#canvasContainer .resize-handle::before, #scatterContainer .resize-handle::before {
    content: ''; position: absolute; bottom: 0; right: 0; width: 0; height: 0;
    border-style: solid; border-width: 0 0 16px 16px; border-color: transparent transparent #3b82f6 transparent;
}
#canvas { background: #ffffff; cursor: grab; display: block; touch-action: none; }
#canvas:active { cursor: grabbing; }
select, .controlButton {
    font-size: 12px; padding: 4px 8px; border: 1px solid #e5e7eb; border-radius: 6px;
    height: 28px; background: white; color: #374151; cursor: pointer; font-family: inherit;
}
select:hover, .controlButton:hover:not(:disabled) { border-color: #d1d5db; background: #f9fafb; }
select:active, .controlButton:active:not(:disabled) { background: #f3f4f6; }
select:focus, .controlButton:focus { outline: none; border-color: #3b82f6; }
select:disabled, .controlButton:disabled { opacity: 0.6; cursor: not-allowed; background: #f3f4f6; color: #9ca3af; }
input[type="range"] { border: none !important; outline: none !important; box-shadow: none !important; }
.controlButton {
    position: relative; min-width: 50px; font-weight: 500; display: inline-flex;
    align-items: center; justify-content: center; white-space: nowrap; margin: 0;
}
.btn-toggle { padding: 0; border: none; background: transparent; }
.btn-toggle:hover { border: none; background: transparent; }
#recordButton, #overlayButton, #playButton { min-width: 28px; padding: 0 5px; }
#overlayButton { font-size: 14px; line-height: 1; }
.btn { border: 1px solid transparent; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.btn-secondary { background: transparent; color: inherit; border-color: transparent; }
.btn-secondary:hover:not(:disabled) { background: #f3f4f6; }
#recordButton { color: #ef4444; font-size: 14px; line-height: 1; }
#recordButton:hover:not(:disabled) { color: #dc2626; background: #fef2f2; }
#recordButton:active:not(:disabled) { color: #b91c1c; background: #fee2e2; }
.btn-toggle { overflow: hidden; padding: 0; display: block; width: 100%; }
.btn-toggle input[type="checkbox"] { position: absolute; opacity: 0; width: 0; height: 0; pointer-events: none; }
.btn-toggle .btn-label {
    display: block; padding: 4px 8px; cursor: pointer; background: white; color: #374151;
    border: 1px solid #e5e7eb; border-radius: 6px; text-align: center; width: 100%;
    height: 28px; line-height: 18px; box-sizing: border-box; font-size: 12px; font-weight: 500;
}
.btn-toggle .btn-label:hover { background: #f9fafb; border-color: #d1d5db; }
.btn-toggle .btn-label:active { background: #f3f4f6; }
.btn-toggle input[type="checkbox"]:checked+.btn-label { background: #e5e7eb; border-color: #d1d5db; color: #374151; }
.btn-toggle input[type="checkbox"]:checked+.btn-label:hover { background: #d1d5db; border-color: #9ca3af; color: #374151; }
.btn-toggle input[type="checkbox"]:checked+.btn-label:active { background: #9ca3af; border-color: #6b7280; color: #374151; }
#controlsContainer {
    display: flex; align-items: center; padding: 0 5px; width: 100%; max-width: 100%;
    gap: 3px; flex-wrap: nowrap !important; align-self: flex-start; white-space: nowrap;
    overflow-x: auto; min-width: 0;
}
#controlsContainer>* { flex-shrink: 0; }
#frameSlider { flex: 1 1 140px; width: auto; min-width: 120px; margin: 0; flex-shrink: 1; }
#frameCounter { color: #374151; min-width: 50px; font-size: 12px; flex-shrink: 0; }
#speedButton { min-width: 28px; padding: 0 5px; }
#rightPanelContainer {
    display: flex; flex-direction: column; gap: 5px; width: 180px; border: 1px solid #e5e7eb;
    border-radius: 10px; padding: 8px; background: #f9fafb; flex-shrink: 0;
    flex: 0 0 auto;
}
.control-group { display: flex; flex-direction: column; gap: 5px; }
.toggle-item { display: flex; align-items: center; gap: 5px; width: 100%; }
.toggle-item label { font-size: 12px; font-weight: 500; color: #6b7280; width: 52px; flex-shrink: 0; white-space: nowrap; }
.toggle-item select { flex-grow: 1; }
.btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
.btn-row .controlButton { width: 100%; min-width: 0; height: 28px; }
.btn-row .btn-toggle { display: block; }
.btn-row .btn-toggle .btn-label { width: 100%; box-sizing: border-box; }
input[type="range"] {
    -webkit-appearance: none; appearance: none; width: 100%; background: transparent;
    flex-grow: 1; cursor: pointer; margin: 0; padding: 0;
}
input[type="range"]::-webkit-slider-runnable-track { width: 100%; height: 5px; background: #e5e7eb; border-radius: 3px; }
input[type="range"]::-moz-range-track { width: 100%; height: 5px; background: #e5e7eb; border-radius: 3px; border: none; }
input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none; width: 14px; height: 14px; border-radius: 50%;
    background: #3b82f6; cursor: pointer; border: 2px solid white; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); margin-top: -4.5px;
}
input[type="range"]::-moz-range-thumb {
    width: 10px; height: 10px; border-radius: 50%; background: #3b82f6; cursor: pointer;
    border: 2px solid white; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}
input[type="range"]:hover::-webkit-slider-thumb { background: #2563eb; }
input[type="range"]:hover::-moz-range-thumb { background: #2563eb; }
input[type="range"]:active::-webkit-slider-thumb { background: #1d4ed8; }
input[type="range"]:active::-moz-range-thumb { background: #1d4ed8; }
    #paeContainer {
        display: none; width: 300px; height: 300px;
        border: 1px solid #ddd; border-radius: 12px; background: #ffffff; overflow: hidden;
        position: relative;
    }
    #paeCanvas { width: 100%; height: 100%; display: block; position: absolute; top: 0; left: 0; touch-action: none; }
    /* Scatter container (matches viewer box) */
    .scatter-container {
        box-sizing: border-box;
        padding: 0;
        border: 1px solid #d1d5db;
        border-radius: 12px;
        background: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
    }
    .scatter-container.box-off {
        padding: 0;
        border: none;
        border-radius: 0;
        background: transparent;
    }
    #scatterCanvas {
        background: transparent;
        display: block;
    }
</style>
<div id="mainContainer">
    <div id="viewerWrapper">
        <div id="canvasContainer">
            <canvas id="canvas"></canvas>
            <div class="resize-handle"></div>
        </div>
        <div id="controlsContainer">
            <button id="playButton" class="controlButton">▶</button>
            <button id="recordButton" class="controlButton" title="Record animation to video file">●</button>
            <input type="range" id="frameSlider" min="0" max="0" value="0">
            <span id="frameCounter">0 / 0</span>
            <button id="speedButton" class="controlButton" title="Cycle playback speed">1x</button>
            <button id="overlayButton" class="controlButton btn btn-secondary" title="Overlay all frames" style="font-weight: 400;">⧉</button>
        </div>
    </div>
    <div id="paeContainer">
        <canvas id="paeCanvas" width="300" height="300" style="cursor: crosshair;"></canvas>
    </div>
    <div id="scatterContainer" class="scatter-container" style="display: none; position: relative;">
        <canvas id="scatterCanvas" style="cursor: pointer;"></canvas>
        <div class="resize-handle" aria-label="Resize scatter plot"></div>
    </div>
    <div id="rightPanelContainer">
        <div class="control-group">
            <div class="toggle-item">
                <select id="objectSelect" style="flex-grow: 1; width: 100%;"></select>
            </div>
            <div class="toggle-item">
                <label for="colorSelect">Color:</label>
                <select id="colorSelect">
                    <option value="auto">Auto</option>
                    <option value="plddt">pLDDT</option>
                    <option value="deepmind">DeepMind</option>
                    <option value="rainbow">Rainbow</option>
                    <option value="chain">Chain</option>
                </select>
            </div>
            <div class="toggle-item">
                <label for="outlineModeSelect">Outline:</label>
                <select id="outlineModeSelect">
                    <option value="none">None</option>
                    <option value="partial">Partial</option>
                    <option value="full">Full</option>
                </select>
            </div>
            <div class="btn-row">
                <label class="controlButton btn-toggle" title="Toggle shadow">
                    <input type="checkbox" id="shadowEnabledCheckbox">
                    <span class="btn-label">Shadow</span>
                </label>
                <label class="controlButton btn-toggle" title="Toggle colorblind mode">
                    <input type="checkbox" id="colorblindCheckbox">
                    <span class="btn-label">Colorblind</span>
                </label>
            </div>
            <div class="toggle-item" style="margin-top: 3px;">
                <label for="lineWidthSlider">Width:</label>
                <input type="range" id="lineWidthSlider" min="2.0" max="4.7" value="3.0" step="0.1">
            </div>
            <div class="toggle-item" style="margin-top: 3px;">
                <label for="orthoSlider">Ortho:</label>
                <input type="range" id="orthoSlider" min="0" max="1" value="1.0" step="0.01">
            </div>
            <div class="btn-row" style="margin-top: 6px;">
                <label class="controlButton btn-toggle" title="Toggle auto-rotation">
                    <input type="checkbox" id="rotationCheckbox">
                    <span class="btn-label">Rotate</span>
                </label>
                <button id="saveSvgButton" class="controlButton" title="Save as SVG">Save SVG</button>
            </div>
        </div>
    </div>
</div>
<!-- DATA_INJECTION_POINT -->
